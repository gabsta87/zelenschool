<ion-content>
<div class="adminContent">

    <h1>Manage</h1>

    <ion-button *ngIf="requestsCount|async as count" (click)="filterRequests()">
        Teachers requests 
        <ion-badge color="danger" slot="end">{{count}}</ion-badge>
    </ion-button>
    <ion-button (click)="addPartner()">
        Partners
    </ion-button>
    <ion-button>
        Photos gallery
    </ion-button>
    <ion-button>
        Projects
    </ion-button>
    <ion-button>
        Articles
    </ion-button>
    <ion-button>
        Rooms
    </ion-button>

    <ion-searchbar placeholder="Search" [(ngModel)]="searchString" (ionChange)="updateSearchValue()"></ion-searchbar>

    <ng-container *ngIf="filteredDataObs | async as filteredData">
    <h1>Users</h1>
    
    <ion-item lines="none">
        <ion-select interface="action-sheet" [(ngModel)]="statusToFilter" (ionChange)="filterUsersList()" value="all">
            <ion-select-option value="all">All</ion-select-option>
            <ion-select-option value="student">Students</ion-select-option>
            <ion-select-option value="teacher">Teachers</ion-select-option>
            <ion-select-option value="admin">Admins</ion-select-option>
            <ion-select-option value="request">Teachers requests </ion-select-option>
            <ion-select-option value="ban">Banned</ion-select-option>
        </ion-select>
    </ion-item>

    <ion-list lines="none">
        <ion-accordion-group [multiple]="true">
            <ion-item *ngFor="let usr of filteredData[0];">
                <ion-accordion [value]="usr['l_name']">
                    <ion-item slot="header" color="light">
                      <ion-label>{{usr['l_name']}} {{usr['f_name']}}</ion-label>
                    </ion-item>
                    <div class="ion-padding" slot="content">
                        <p>email : {{usr['email']}}</p>
                        <p>Status : {{usr['status']}}</p>
                        <p *ngIf="usr['phone']">Phone : {{usr['phone']}}</p>
                        <p *ngIf="usr['birthday']">Birthday : {{usr['birthday']}}</p>
                        <p *ngIf="usr['s_permit_id']">S permit ID : {{usr['s_permit_id']}}</p>
                        <p *ngIf="usr['address']">Address : {{usr['address']}}</p>
                        <p *ngIf="usr['subscribeDate']">Subscribe date : {{usr['subscribeDate']}}</p>
                        <ion-text *ngIf="usr['ban']" color="danger">
                        <p> Banned on : {{usr['ban'].date}} by {{usr['ban'].author?.l_name}} {{usr['ban'].author?.f_name}}<br>
                        Reason : {{usr['ban'].comment}}</p>
                        </ion-text>
                        <span>
                        <ion-button *ngIf="usr['ban'] == undefined; else unban" (click)="banUser(usr['id'])">Ban</ion-button>
                        <ng-template #unban>
                            <ion-button (click)="unbanUser(usr['id'])">Unban</ion-button>
                        </ng-template>
                        <ion-button (click)="deleteUser(usr['id'])">Delete</ion-button>
                        <ion-button *ngIf="usr['status']=='request'" (click)="acceptRequest(usr['id'])">Accept teacher</ion-button>
                        </span>
                    </div>
                </ion-accordion>
            </ion-item>
        </ion-accordion-group>
    </ion-list>

    <h1>Courses</h1>

    <ion-item lines="none">
        <ion-select interface="action-sheet" [(ngModel)]="timeFilter" (ionChange)="filterCoursesList()" value="all">
            <ion-select-option value="all">All</ion-select-option>
            <ion-select-option value="future">Courses to come</ion-select-option>
            <ion-select-option value="past">Past courses</ion-select-option>
        </ion-select>
    </ion-item>

    <ion-list lines="none">
        <ion-accordion-group [multiple]="true">
            <ion-item *ngFor="let course of filteredData[1]">
                <ion-accordion [value]="course['title']">
                    <ion-item slot="header" color="light">
                      <ion-label>{{course['title']}} {{course['timeStart']| date: "HH:mm d MMM, yy"}} {{course['author'].l_name}} {{course['author'].f_name}}</ion-label>
                    </ion-item>
                    <div class="ion-padding" slot="content" (click)="handleEvent(course)">
                        <p>Room : {{course['room_id']}}</p>
                        <p>Participants : {{course['attendantsId'].length}}/{{course['max_participants']}}</p>
                        <p *ngIf="course['description']">Description : {{course['description']}}</p>
                        <ion-list *ngIf="course['attendantsId'].length > 0" class="ion-no-padding">
                            <ion-label>Students</ion-label>
                            <ion-item *ngFor="let student of course['attendantsId']">
                                <ion-label *ngIf="student; else unknown">{{student['l_name']}} {{student['f_name']}}</ion-label>
                                <ng-template #unknown><ion-label>Unknown</ion-label></ng-template>
                            </ion-item>
                        </ion-list>
                    </div>
                </ion-accordion>
            </ion-item>
        </ion-accordion-group>
    </ion-list>
    </ng-container>

    <h1>Association members</h1>
    <ion-button>Add new</ion-button>
    <ion-list lines="none">
        <ion-accordion-group>
            <ion-item *ngFor="let usr of (assoMembers|async)">
                <ion-accordion [value]="usr['name']">
                    <ion-item slot="header" color="light">
                      <ion-label>{{usr['name']}} {{usr['role']}}</ion-label>
                    </ion-item>
                    <div class="ion-padding" slot="content">
                        
                        <div *ngIf="editingMember.value; else displayMember" >
                            <ion-grid>
                                <ion-row>
                                    <ion-col size="1">
                                        <ion-label>Name</ion-label>
                                    </ion-col>
                                    <ion-col>
                                        <ion-input type="text" [(ngModel)]="memberNewName"> </ion-input>
                                    </ion-col>
                                </ion-row>
                                <ion-row>
                                    <ion-col size="1">
                                        <ion-label>Role</ion-label>
                                    </ion-col>
                                    <ion-col>
                                        <ion-input type="text" [(ngModel)]="memberNewRole"> </ion-input>
                                    </ion-col>
                                </ion-row>
                                <ion-row>
                                    <ion-col size="1">
                                        <ion-label>Link</ion-label>
                                    </ion-col>
                                    <ion-col>
                                        <ion-input type="text" [(ngModel)]="memberNewLink"> </ion-input>
                                    </ion-col>
                                </ion-row>
                            </ion-grid>

                            <ion-thumbnail>
                                <ion-img [src]="'/assets/members/'+usr['photo']" alt="Profile view" (click)="setImageLink()"></ion-img>
                            </ion-thumbnail>
                            
                            <span>
                                <ion-button color="danger" (click)="deleteMember(usr['id'])">Delete</ion-button>
                                <ion-button (click)="cancelMemberEdit()">Cancel</ion-button>
                                <ion-button (click)="updateMember()">Update</ion-button>
                            </span>
                        </div>

                        <ng-template #displayMember>
                            <p>Name : {{usr['name']}}</p>
                            <p>Role : {{usr['role']}}</p>
                            <p>Link : {{usr['link']}}</p>
                            <ion-thumbnail>
                                <ion-img [src]="'/assets/members/'+usr['photo']" alt="Profile view"></ion-img>
                            </ion-thumbnail>
                            <span>
                                <ion-button color="danger" (click)="deleteMember(usr['id'])">Delete</ion-button>
                                <ion-button (click)="editMember(usr['id'])">Edit</ion-button>
                            </span>
                        </ng-template>

                    </div>
                </ion-accordion>
            </ion-item>
        </ion-accordion-group>
    </ion-list>

</div>
</ion-content>